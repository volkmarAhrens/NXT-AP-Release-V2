/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/core/Lib","sap/ui/fl/Layer","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/core/BusyIndicator","sap/base/Log","sap/m/MessageBox"],function(e,t,n,r,s,a,i,o,u,l,S,c){"use strict";var E="/flex/keyuser";var R=e({},r,{layers:[n.CUSTOMER,n.PUBLIC],ROUTES:{CHANGES:`${E+s.API_VERSION}/changes/`,SETTINGS:`${E+s.API_VERSION}/settings`,TOKEN:`${E+s.API_VERSION}/settings`,VERSIONS:{GET:`${E+s.API_VERSION}/versions/`,ACTIVATE:`${E+s.API_VERSION}/versions/activate/`,DISCARD:`${E+s.API_VERSION}/versions/draft/`,PUBLISH:`${E+s.API_VERSION}/versions/publish/`},TRANSLATION:{UPLOAD:`${E+s.API_VERSION}/translation/texts`,DOWNLOAD:`${E+s.API_VERSION}/translation/texts/`,GET_SOURCELANGUAGE:`${E+s.API_VERSION}/translation/sourcelanguages/`},CONTEXTS:`${E+s.API_VERSION}/contexts/`},isLanguageInfoRequired:true,loadFeatures(e){return r.loadFeatures.call(this,e).then(function(e){e.isContextSharingEnabled=true;return e})},getContexts(e){var t=["type","$skip","$filter"];var n=o(e,t);var r=a.getUrl(this.ROUTES.CONTEXTS,e,n);return a.sendRequest(r,"GET",{initialConnector:s}).then(function(e){return e.response})},loadContextDescriptions(e){var t={};a.addLanguageInfo(t);T.call(this,e);var n=a.getUrl(this.ROUTES.CONTEXTS,e,t);e.payload=JSON.stringify(e.flexObjects);e.dataType="json";e.contentType="application/json; charset=utf-8";return i.sendRequest(n,"POST",e).then(function(e){return e.response})},isContextSharingEnabled(){return Promise.resolve(true)},getFlexInfo(e){return u.get(e.selector)||{}}});function T(e){e.initialConnector=s;e.tokenUrl=this.ROUTES.TOKEN}function O(e){var t={title:e.title};e.payload=JSON.stringify(t);e.dataType="json";e.contentType="application/json; charset=utf-8"}function g(e){e.version=e.versionNumber.toString();delete e.versionNumber;return e}R.versions={load(e){T.call(this,e);var t={};a.addLanguageInfo(t);t.limit=e.limit;var n=a.getUrl(this.ROUTES.VERSIONS.GET,e,t);return a.sendRequest(n,"GET",e).then(function(e){return e.response.versions.map(function(e){return g(e)})})},activate(e){T.call(this,e);O(e);var t={version:e.version};a.addLanguageInfo(t);var n=a.getUrl(this.ROUTES.VERSIONS.ACTIVATE,e,t);return i.sendRequest(n,"POST",e).then(function(e){var t=e.response;return g(t)})},discardDraft(e){T.call(this,e);var t=a.getUrl(this.ROUTES.VERSIONS.DISCARD,e);return i.sendRequest(t,"DELETE",e)},publish(e){var n=t.getResourceBundleFor("sap.ui.fl");var r=function(t){l.hide();var r=n.getText("MSG_CF_PUBLISH_ERROR",t?[t.message||t]:undefined);var s=n.getText("HEADER_TRANSPORT_ERROR");S.error(`publish version error${t}`);c.show(r,{icon:c.Icon.ERROR,title:s,styleClass:e.styleClass});return"Error"};T.call(this,e);var s={version:e.version};var o=a.getUrl(this.ROUTES.VERSIONS.PUBLISH,e,s);return i.sendRequest(o,"POST",e).then(function(){l.hide();return n.getText("MSG_CF_PUBLISH_SUCCESS")}).catch(r)}};R.translation={getTexts(e){T.call(this,e);var t=o(e,["sourceLanguage","targetLanguage"]);var n=a.getUrl(this.ROUTES.TRANSLATION.DOWNLOAD,e,t);return a.sendRequest(n,"GET",e).then(function(e){return e.response})},getSourceLanguages(e){T.call(this,e);var t={};var n=a.getUrl(this.ROUTES.TRANSLATION.GET_SOURCELANGUAGE,e,t);return a.sendRequest(n,"GET",e).then(function(e){return e&&e.response&&e.response.sourceLanguages?e.response.sourceLanguages:[]})},postTranslationTexts(e){T.call(this,e);var t=a.getUrl(this.ROUTES.TRANSLATION.UPLOAD,e,{});return a.sendRequest(t,"POST",e)}};R.initialConnector=s;return R});
//# sourceMappingURL=KeyUserConnector.js.map