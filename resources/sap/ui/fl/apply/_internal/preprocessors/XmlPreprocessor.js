/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/core/util/reflection/XmlTreeModifier","sap/ui/core/Component","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/controlVariants/VariantManagementState","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/Utils","sap/base/Log"],function(e,t,n,a,i,r,o,s,p,l){"use strict";var c=function(){};c.NOTAG="<NoTag>";c.process=async function(i,r){try{r.viewId=r.id;var o=n.getComponentById(r.componentId);if(!o){l.warning("View is generated without a component. Flexibility features are not possible.");return i}var c=p.getAppComponentForControl(o);if(!p.isApplication(c.getManifestObject())){return i}const f=e({appComponent:c,modifier:t,view:i},r);var u=s.getChangePersistenceForControl(c);const g=await u.getChangesForView(f);await a.applyAllChangesForXMLView(f,g);l.debug(`flex processing view ${r.id} finished`);return i}catch(e){var f=`view ${r.id}: ${e}`;l.info(f);return i}};function u(e,t){if(!t){return e}return e.concat("-",t)}function f(e){return e.replace(/(^W\/|")/g,"")}c.getCacheKey=async function(e){const t=n.getComponentById(e.componentId);const a=p.getAppComponentForControl(t);if(p.isVariantByStartupParameter(a)){return undefined}const s=o.getFlexReferenceForControl(a);let l=c.NOTAG;if(s){const e=await r.getStorageResponse(s);if(e?.cacheKey){l=f(e.cacheKey);const t=i.getAllCurrentVariants(s).filter(e=>!e.getStandardVariant()).map(e=>e.getId());l=u(l,t.join("-"))}}return l};return c},true);
//# sourceMappingURL=XmlPreprocessor.js.map