/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Control","sap/ui/core/Lib","sap/ui/core/UIComponent","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/util/showMessageBox","sap/ui/rta/RuntimeAuthoring"],function(t,e,r,n,o,a,i,s,u,l){"use strict";function f(t){if(i.CUSTOMER===t){return o.isKeyUser().then(function(t){if(!t){var e=r.getResourceBundleFor("sap.ui.rta");var n=new Error(e.getText("MSG_NO_KEY_USER_RIGHTS_ERROR_MESSAGE"));n.reason="isKeyUser";throw n}})}return Promise.resolve()}function T(t){var e=new URLSearchParams(window.location.search).get("fiori-tools-rta-mode");if(!e||e==="false"){var r=t.getManifest()||{};var n=r["sap.ui5"]&&r["sap.ui5"].flexEnabled;if(n===false){var o=Error("This app is not enabled for key user adaptation");o.reason="flexEnabled";throw o}}}function c(t){const e=t.getComponentData?.();if(e?.startupParameters&&Array.isArray(e.startupParameters["sap-app-id"])){const e=t.getManifest();const n=e["sap.app"]?.ach;const o=r.getResourceBundleFor("sap.ui.rta");const a=o.getText("MSG_PSEUDO_APP_VARIANT_ERROR_MESSAGE",[n]);const i=Error(a);i.reason="pseudoAppVariant";throw i}}function p(o,p,A,_,E){var g;return Promise.resolve().then(function(){if(!(o.rootControl instanceof e)&&!(o.rootControl instanceof n)){var t=Error("An invalid root control was passed");t.reason="rootControl";throw t}o.rootControl=s.getAppComponentForControl(o.rootControl)}).then(f.bind(undefined,o.flexSettings.layer)).then(function(){return T(o.rootControl)}).then(c.bind(undefined,o.rootControl)).then(function(){g=new l(o);if(A){g.attachEvent("start",A)}if(_){g.attachEvent("failed",_)}var t=E||function(){g.destroy()};g.attachEvent("stop",t);if(p){return p(g)}}).then(function(){return g.start()}).then(function(){if(o.flexSettings.layer==="CUSTOMER"){var t={oComponent:o.rootControl,selector:o.rootControl,invalidateCache:false,includeVariants:true,includeCtrlVariants:true,currentLayer:i.CUSTOMER};a.getChangesWarning(t).then(function(t){if(t.showWarning){var e=r.getResourceBundleFor("sap.ui.rta");var n=t.warningType==="mixedChangesWarning"?{text:"MSG_ADAPTATION_STARTER_MIXED_CHANGES_WARNING",title:"TIT_ADAPTATION_STARTER_MIXED_CHANGES_TITLE"}:{text:"MSG_ADAPTATION_STARTER_NO_CHANGES_IN_P_WARNING",title:"TIT_ADAPTATION_STARTER_NO_CHANGES_IN_P_TITLE"};u(e.getText(n.text),{title:e.getText(n.title)},"warning")}})}return g}).catch(function(e){if(e!=="Reload triggered"&&!(s.getUshellContainer()&&e.reason==="flexEnabled")){var n=r.getResourceBundleFor("sap.ui.rta");if(e.reason==="pseudoAppVariant"){u(e.message,{title:n.getText("MSG_ADAPTATION_COULD_NOT_START")},"error")}else{u(n.getText("MSG_GENERIC_ERROR_MESSAGE",[e.message]),{title:n.getText("MSG_ADAPTATION_COULD_NOT_START")},"error")}t.error("UI Adaptation could not be started",e.message)}throw e})}return p});
//# sourceMappingURL=adaptationStarter.js.map