/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/fl/write/api/ReloadInfoAPI","sap/ui/fl/write/api/VersionsAPI","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/Utils"],function(e,a,t,r,n,i,o){"use strict";var s={};var l={};var A={NOT_NEEDED:"NO_RELOAD",VIA_HASH:"CROSS_APP_NAVIGATION",RELOAD_PAGE:"HARD_RELOAD"};function u(e){return{target:{semanticObject:e.semanticObject,action:e.action,context:e.contextRaw},params:e.params,appSpecificRoute:e.appSpecificRoute,writeHistory:false}}function _(e){var a;var t=e.layer===n.CUSTOMER;if(e.hasHigherLayerChanges&&e.isDraftAvailable){a=t?"MSG_VIEWS_OR_PERSONALIZATION_AND_DRAFT_EXISTS":"MSG_HIGHER_LAYER_CHANGES_AND_DRAFT_EXISTS"}else if(e.hasHigherLayerChanges&&e.allContexts){a="MSG_RESTRICTED_CONTEXT_EXIST_AND_PERSONALIZATION"}else if(e.hasHigherLayerChanges){a=t?"MSG_PERSONALIZATION_OR_PUBLIC_VIEWS_EXISTS":"MSG_HIGHER_LAYER_CHANGES_EXIST"}else if(e.isDraftAvailable){a="MSG_DRAFT_EXISTS"}else if(e.allContexts){a="MSG_RESTRICTED_CONTEXT_EXIST"}return a}function f(e){var a=e.layer===n.CUSTOMER;if(e.hasHigherLayerChanges){if(!a){return"MSG_RELOAD_WITH_ALL_CHANGES"}if(e.isDraftAvailable){return"MSG_RELOAD_WITH_VIEWS_PERSONALIZATION_AND_WITHOUT_DRAFT"}if(e.allContexts){return"MSG_RELOAD_WITH_PERSONALIZATION_AND_RESTRICTED_CONTEXT"}if(e.switchEndUserAdaptation){return"MSG_RELOAD_WITH_PERSONALIZATION_AND_CONTEXT_BASED_ADAPTATION"}return"MSG_RELOAD_WITH_PERSONALIZATION_AND_VIEWS"}if(e.initialDraftGotActivated){return"MSG_RELOAD_ACTIVATED_DRAFT"}if(e.isDraftAvailable){return"MSG_RELOAD_WITHOUT_DRAFT"}if(e.changesNeedReload){return"MSG_RELOAD_NEEDED"}if(e.allContexts){return"MSG_RELOAD_WITHOUT_ALL_CONTEXT"}if(e.switchEndUserAdaptation){return"MSG_RELOAD_OTHER_CONTEXT_BASED_ADAPTATION"}return undefined}function E(e){var a=f(e);if(a){return o.showMessageBox("information",a,{titleKey:"HEADER_RELOAD_NEEDED"})}return Promise.resolve()}function d(e,a,t){return Promise.resolve().then(function(){if(l.CrossApplicationNavigation&&a){if(e.isDraftAvailable){return r.loadDraftForApplication({control:e.selector,layer:e.layer,allContexts:e.allContexts,adaptationId:e.adaptationId})}return r.loadVersionForApplication({control:e.selector,layer:e.layer,allContexts:e.allContexts,adaptationId:e.adaptationId})}return undefined}).then(function(){var a=_(e);return t?undefined:o.showMessageBox("information",a)}).then(function(){s.enableAutomaticStart(e.layer,e.selector);e.onStart=true;return s.triggerReload(e)}).then(function(){return true})}function c(e){e.parameters=document.location.search;if(e.onStart){t.handleParametersOnStart(e,"standalone")}else{t.handleUrlParameters(e,"standalone")}if(document.location.search===e.parameters){s.reloadPage()}else{s.setUriParameters(e.parameters)}}function R(e){e.URLParsingService=l.URLParsing;e.parsedHash=i.getParsedURLHash(l.URLParsing);e.parameters=e.parsedHash.params;var a=e.onStart?t.handleParametersOnStart(e,"flp"):t.handleUrlParameters(e,"flp");if(a){l.CrossApplicationNavigation.toExternal(u(e.parsedHash))}else{l.AppLifeCycle.reloadCurrentApp()}if(e.triggerHardReload){s.reloadPage()}}s.setUShellServices=function(e){l=e};s.enableAutomaticStart=function(e,t){var r=a.getFlexReference({element:t});var n=r||true;window.sessionStorage.setItem(`sap.ui.rta.restart.${e}`,n)};s.disableAutomaticStart=function(e){window.sessionStorage.removeItem(`sap.ui.rta.restart.${e}`)};s.needsAutomaticStart=function(e){return!!window.sessionStorage.getItem(`sap.ui.rta.restart.${e}`)};s.triggerReload=function(e){if(i.getUshellContainer()){R(e)}else{c(e)}};s.reloadPage=function(){window.location.reload()};s.setUriParameters=function(e){document.location.search=e};s.handleReloadOnStart=function(a){e(a,{hasHigherLayerChanges:false,isDraftAvailable:false,ignoreMaxLayerParameter:false,includeCtrlVariants:true,URLParsingService:l.URLParsing});return t.getReloadReasonsForStart(a).then(function(e){if(e.hasHigherLayerChanges||e.isDraftAvailable||e.allContexts||e.switchAdaptation){return d(e,a.versioningEnabled,a.developerMode)}return undefined})};s.checkReloadOnExit=function(e){return e.changesNeedReloadPromise.then(function(a){e.changesNeedReload=a;e.URLParsingService=l.URLParsing;var r=t.getReloadMethod(e);return E(r).then(function(){r.triggerHardReload=r.reloadMethod===A.RELOAD_PAGE;return r})})};s.handleUrlParametersOnExit=function(e){if(e.layer!==n.USER&&e.reloadMethod!==A.NOT_NEEDED){e.removeVersionParameter=true;s.triggerReload(e)}};return s});
//# sourceMappingURL=ReloadManager.js.map