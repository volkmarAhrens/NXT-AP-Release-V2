<mvc:View
    controllerName="nxt.ap.release.controller.APRelease"
    xmlns:util="nxt.ap.release.util"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:form="sap.ui.layout.form"
    xmlns:layout="sap.ui.layout"
    displayBlock="true">
    
    <!-- We can use the util namespace that's already defined at the top: xmlns:util="nxt.ap.release.util" -->
    
    <f:DynamicPage id="apReleasePage">
        <f:header>
    <f:DynamicPageHeader>
        <HBox alignItems="Center" justifyContent="SpaceBetween" class="sapUiMediumMarginBeginEnd">
            <!-- App Branding Section -->
            <HBox alignItems="Center">
                <Image src="resources/img/nxt4sap.png" alt="Company Logo" width="60px" height="40px"/>
                <Title text="{i18n>appTitle}" level="H3" class="sapUiTinyMarginBegin"/>
            </HBox>
            
            <!-- User Identity Section - SSO Information -->
            <HBox alignItems="Center" class="sapUiTinyMarginTopBottom">
                <Avatar 
                    src="{= ${user>/photoUrl} ? ${user>/photoUrl} : 'sap-icon://person-placeholder' }" 
                    displaySize="XS" 
                    class="sapUiTinyMarginEnd"
                    press="onAvatarPress"/>
                <VBox>
                    <!-- User Display Name from Google/Microsoft SSO -->
                    <HBox alignItems="Center">
                        <ObjectStatus 
                            title="" 
                            text="{user>/displayName}" 
                            state="Information" 
                            icon="{= ${user>/isExternalUser} ? 'sap-icon://journey-arrive' : 'sap-icon://employee' }"/>
                    </HBox>
                    <!-- User Email/Account Type Info with Language Indicator -->
                    <HBox alignItems="Center" class="sapUiTinyFontSize">
                        <Text text="{= ${user>/email} || ${user>/accountType} + ' Account' }" />
                        <!-- Language indicator removed as requested -->
                    </HBox>
                </VBox>
                <Button 
                    icon="sap-icon://menu" 
                    type="Transparent" 
                    press="onUserMenuPress" 
                    class="sapUiTinyMarginBegin" 
                    tooltip="User Options"/>
            </HBox>
        </HBox>
    </f:DynamicPageHeader>
</f:header>
<f:title>
    <f:DynamicPageTitle/>

        </f:title>
        <f:content>
            <VBox>
    
                <!-- Header Info -->
                
                <VBox class="sapUiTinyMarginBottom">
    <layout:Grid id="invoiceOverviewPanel" defaultSpan="XL4 L4 M4 S12" class="sapUiTinyMarginBottom">
        <!-- Column 1: Requester, Approver, Nature of Invoice -->
        <VBox class="sapUiSmallMargin">
            <!-- Row 1 -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="requesterLabel" text="Requester:" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Process/Requestor}"/>
            </HBox>
            
            <!-- Row 2 -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="approverLabel" text="Approver:" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Process/Approver}"/>
            </HBox>
            
            <!-- Row 3 -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="natureOfInvoiceLabel" text="Nature of Invoice:" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Header/NatureOfInvoice}"/>
            </HBox>
        </VBox>
        
        <!-- Column 2: Total amount, Discount, Invoice Date -->
        <VBox class="sapUiSmallMargin">
            <!-- Row 1: Total amount -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="totalAmountLabel" text="Total Amount:" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Header/InvoiceTotalAmountFormatted}"/>
            </HBox>
            
            <!-- Row 2: Discount (moved from column 3) -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="discountAmountLabel" text="Discount:" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Header/DiscountAmountFormatted}"/>
            </HBox>
            
            <!-- Row 3: Invoice Date (moved to bottom) -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="invoiceDateLabel" text="Invoice Date:" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Header/InvoiceDate}"/>
            </HBox>
        </VBox>
        
        <!-- Column 3: Activity, Due date, AP Time -->
        <VBox class="sapUiSmallMargin">
            <!-- Row 1: Activity (moved to top) -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="activityLabel" text="Activity:" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Process/Activity}"/>
            </HBox>
            
            <!-- Row 2: Due date (moved to middle) -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="invoiceDueDateLabel" text="Due Date:" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Header/InvoiceDueDate}"/>
            </HBox>
            
            <!-- Row 3: AP Time (moved to bottom) -->
            <HBox class="sapUiTinyMarginBottom">
                <Label id="apTimeLabel" text="AP Time (D):" class="sapUiSmallMarginEnd" width="120px"/>
                <Text text="{Process/APTime}"/>
            </HBox>
        </VBox>
    </layout:Grid>
</VBox>
                <!-- Invoices Table -->
                <!-- Invoices Table (Master) -->
<Table
    id="invoicesTable"
    mode="SingleSelectMaster"
    items="{/Invoices}"
    selectionChange="onInvoiceSelectionChange"
    updateFinished="onInvoicesTableUpdateFinished"
    growing="true"
    growingScrollToLoad="true"
    width="100%">
    <headerToolbar>
        <OverflowToolbar>
            <Title text="{i18n>invoices}" level="H2"/>
            <!-- Search field removed per requirements -->
            <Button text="{i18n>releaseForPosting}" type="Emphasized" press="onReleaseForPosting" icon="sap-icon://accept"/>
            <Button text="{i18n>rejectWithComment}" press="onRejectWithComment" icon="sap-icon://decline"/>
            <!-- 'Forward with Inquiry' button removed as requested -->
            <Button text="{i18n>documents}" press="onDocuments" icon="sap-icon://document"/>
            <Button text="{i18n>processLog}" press="onProcessLog" icon="sap-icon://process"/>
            <!-- NXT AI button removed as requested -->
            <ToolbarSpacer/>
            <!-- 'Refresh' button removed as requested -->
            <!-- Dropdown select removed per requirements -->
            <Button icon="sap-icon://sort" text="{i18n>sort}" press="onSortInvoices"/>
            <Button icon="sap-icon://filter" tooltip="{i18n>filter}" press="onFilterInvoices"/>
            <Button icon="sap-icon://action-settings" tooltip="{i18n>personalizeColumns}" press="onPersonalizeInvoices"/>
        </OverflowToolbar>
    </headerToolbar>
    <columns>
        <Column id="invoicesTableColumnCompanyCode"><Text text="{i18n>companyCode}"/></Column>
        <Column id="invoicesTableColumnSAPDocumentNumber"><Text text="{i18n>sapDocumentNumber}"/></Column>
        <Column id="invoicesTableColumnFiscalYear"><Text text="{i18n>fiscalYear}"/></Column>
        <Column id="invoicesTableColumnVendorName"><Text text="{i18n>vendorName}"/></Column>
        <Column id="invoicesTableColumnVendorID"><Text text="{i18n>vendorId}"/></Column>
        <Column id="invoicesTableColumnInvoiceReference"><Text text="{i18n>invoiceReference}"/></Column>
        <Column id="invoicesTableColumnInvoiceNetAmount"><Text text="{i18n>invoiceNetAmount}"/></Column>
        <Column id="invoicesTableColumnInvoiceTaxAmount"><Text text="{i18n>invoiceTaxAmount}"/></Column>
        <Column id="invoicesTableColumnInvoiceTotalAmount"><Text text="{i18n>invoiceTotalAmount}"/></Column>
        <!-- Currency column removed: currency is now included in the formatted amount fields -->
        <Column id="invoicesTableColumnInvoiceDate"><Text text="{i18n>invoiceDate}"/></Column>
        <Column id="invoicesTableColumnNatureOfInvoice"><Text text="{i18n>natureOfInvoice}"/></Column>
        <Column id="invoicesTableColumnInvoiceDueDate"><Text text="{i18n>invoiceDueDate}"/></Column>
        <Column id="invoicesTableColumnDiscountAmount"><Text text="{i18n>discountAmount}"/></Column>
        <Column id="invoicesTableColumnUnplannedCosts"><Text text="{i18n>unplannedCosts}"/></Column>
    </columns>
    <items>
        <ColumnListItem>
            <cells>
                <Text text="{Header/CompanyCode}"/>
                <Text text="{Header/SAPDocumentNumber}"/>
                <Text text="{Header/FiscalYear}"/>
                <Text text="{Header/VendorName}"/>
                <Text text="{Header/VendorID}"/>
                <Text text="{Header/InvoiceReference}"/>
                <Text text="{Header/InvoiceNetAmountFormatted}"/>
                <Text text="{Header/InvoiceTaxAmountFormatted}"/>
                <Text text="{Header/InvoiceTotalAmountFormatted}"/>
                <!-- Currency cell removed: now included in formatted amount fields -->
                <Text text="{Header/InvoiceDate}"/>
                <Text text="{Header/NatureOfInvoice}"/>
                <Text text="{Header/InvoiceDueDate}"/>
                <Text text="{Header/DiscountAmountFormatted}"/>
                <Text text="{Header/UnplannedCostsFormatted}"/>
            </cells>
        </ColumnListItem>
    </items>
</Table>

                <!-- Line Items Table -->
                <!-- Line Items Table (Detail) -->
<Table
    id="lineItemsTable"
    items="{path: 'LineItems'}"
    growing="true"
    growingScrollToLoad="true"
    width="100%">
    <headerToolbar>
        <OverflowToolbar>
            <Title text="{i18n>lineItems}" level="H2"/>
            <ToolbarSpacer/>
            <!-- Search field removed per requirements -->
            <!-- 'Refresh' button removed as requested -->
            <Button icon="sap-icon://sort" text="{i18n>sort}" press="onSortLineItems"/>
            <Button icon="sap-icon://filter" tooltip="{i18n>filter}" press="onFilterLineItems"/>
            <Button icon="sap-icon://action-settings" tooltip="{i18n>personalizeColumns}" press="onPersonalizeLineItems"/>
        </OverflowToolbar>
    </headerToolbar>
    <columns>
        <Column id="lineItemsTableColumnLineType"><Text text="{i18n>lineType}"/></Column>
        <Column id="lineItemsTableColumnPurchaseOrder"><Text text="{i18n>purchaseOrder}"/></Column>
        <Column id="lineItemsTableColumnDescription"><Text text="{i18n>description}"/></Column>
        <Column id="lineItemsTableColumnMaterialCode"><Text text="{i18n>materialCode}"/></Column>
        <Column id="lineItemsTableColumnQuantity"><Text text="{i18n>quantity}"/></Column>
        <Column id="lineItemsTableColumnAmount"><Text text="{i18n>amount}"/></Column>
        <Column id="lineItemsTableColumnGLAccount"><Text text="{i18n>glAccount}"/></Column>
        <Column id="lineItemsTableColumnCostCenter"><Text text="{i18n>costCenter}"/></Column>
        <Column id="lineItemsTableColumnWBS"><Text text="{i18n>wbs}"/></Column>
    </columns>
    <items>
        <ColumnListItem>
            <cells>
                <Text text="{LineType}"/>
                <Text text="{PurchaseOrder}"/>
                <Text text="{Description}"/>
                <Text text="{MaterialCode}"/>
                <Text text="{Quantity}"/>
                <Text text="{AmountFormatted}"/>
                <Text text="{GLAccount}"/>
                <Text text="{CostCenter}"/>
                <Text text="{WBS}"/>
            </cells>
        </ColumnListItem>
    </items>
</Table>
            </VBox>
        </f:content>
    </f:DynamicPage>
</mvc:View>
